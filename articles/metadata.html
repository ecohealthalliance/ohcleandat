<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Metadata: Creating Standard Metadata with `{ohcleandat}` and `{deposits}` â€¢ ohcleandat</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Metadata: Creating Standard Metadata with `{ohcleandat}` and `{deposits}`">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">ohcleandat</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.3.6</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/idcheck.html">ID Correction and Autobot</a></li>
    <li><a class="dropdown-item" href="../articles/integration.html">Integrating Different Datasets</a></li>
    <li><a class="dropdown-item" href="../articles/mechanics.html">Mechanics: Data Cleaning and Validation Pipeline</a></li>
    <li><a class="dropdown-item" href="../articles/metadata.html">Metadata: Creating Standard Metadata with `{ohcleandat}` and `{deposits}`</a></li>
    <li><a class="dropdown-item" href="../articles/outputs.html">Understanding The Pipeline Outputs</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Metadata: Creating Standard Metadata with `{ohcleandat}` and `{deposits}`</h1>
            
      

      <div class="d-none name"><code>metadata.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ecohealthalliance.github.io/ohcleandat/">ohcleandat</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">deposits</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/frictionlessdata/frictionless-r" class="external-link">frictionless</a></span><span class="op">)</span></span></code></pre></div>
<p>One if the primary aims of cleaning data is to be able to work with
it. Whether working with data shortly after it was created, or years
later, proper metadata make it easier to know whats in a dataset or data
package.</p>
<p>In extremely broad terms, there are two types of metadata: 1)
descriptive metadata - the who what where why when of the dataset. 2)
structural metadata - what do individual fields mean and how to do fit
together? This vignette focuses on creating descriptive metadata with
the {deposits} and {frictionless} packages and structural metadata using
functions in {ohcleandat}.</p>
<div class="section level2">
<h2 id="creating-structural-metadata-with-ohcleandat">Creating structural metadata with {ohcleandat}<a class="anchor" aria-label="anchor" href="#creating-structural-metadata-with-ohcleandat"></a>
</h2>
<p>Because {ohcleandat} largely deals with cleaning tabular data, we can
use a standard (and extensible) structural metadata format to describe
outputs.</p>
<p>The basic structural metadata table produced has the following
elements</p>
<ul>
<li>
<code>name</code> = The name of the field. This is taken as is from
<code>data</code>.</li>
<li>
<code>description</code> = Description of that field. May be
provided by controlled vocabulary</li>
<li>
<code>units</code> = Units of measure for that field. May or may not
apply</li>
<li>
<code>term_uri</code> = Universal Resource Identifier for a term
from a controlled vocabulary or schema</li>
<li>
<code>comments</code> = Free text providing additional details about
the field</li>
<li>
<code>primary_key</code> = <code>TRUE</code> or <code>FALSE</code>,
Uniquely identifies each record in the data</li>
<li>
<code>foreign_key</code> = <code>TRUE</code> or <code>FALSE</code>,
Allows for linkages between data sets. Uniquely identifies records in a
different data set</li>
</ul>
<p>Additional metadata elements can be added by creating then column
binding an empty <code>data.frame</code> to the basic structure.</p>
<div class="section level3">
<h3 id="basic-example">Basic Example:<a class="anchor" aria-label="anchor" href="#basic-example"></a>
</h3>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co">## read in your data</span></span>
<span><span class="va">data_to_describe</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="fl">19961</span><span class="op">:</span><span class="fl">19970</span><span class="op">)</span>,</span>
<span>                                   measurement <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">100</span>,<span class="fl">10</span><span class="op">)</span>,</span>
<span>                                   measured_by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Collin"</span>,<span class="st">"Johana"</span><span class="op">)</span>,size <span class="op">=</span> <span class="fl">10</span>,replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>                                   site_name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">letters</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span>,size <span class="op">=</span> <span class="fl">10</span>,replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>                                   field_we_dont_need <span class="op">=</span> <span class="st">"nothing useful here"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># create metadata</span></span>
<span><span class="va">structural_metadata</span>  <span class="op">&lt;-</span> <span class="fu">ohcleandat</span><span class="fu">::</span><span class="fu"><a href="../reference/create_structural_metadata.html">create_structural_metadata</a></span><span class="op">(</span><span class="va">data_to_describe</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># write to csv</span></span>
<span><span class="va">structural_metadata</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/write.table.html" class="external-link">write.csv</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">"metadata_examples/structural_metadata.csv"</span>,row.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Fill in metadata by hand and read</span></span>
<span></span>
<span><span class="va">structural_metadata_complete</span> <span class="op">&lt;-</span> <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_csv</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">"metadata_examples/structural_metadata_complete.csv"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="what-if-the-structure-of-my-data-change">What if the structure of my data change?<a class="anchor" aria-label="anchor" href="#what-if-the-structure-of-my-data-change"></a>
</h3>
<p>Do I have to re-write my metadata? Maybe! But in certain
cirucumstances you can just update the metadata.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co">## oops I forgot to add a primary key</span></span>
<span><span class="va">data_to_describe</span><span class="op">$</span><span class="va">key</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fl">10</span></span>
<span></span>
<span></span>
<span><span class="co"># add primary key and label it as a primary key in the metadata</span></span>
<span></span>
<span><span class="va">structural_metadata_pk</span><span class="op">&lt;-</span> <span class="fu">ohcleandat</span><span class="fu">::</span><span class="fu"><a href="../reference/update_structural_metadata.html">update_structural_metadata</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">data_to_describe</span>,metadata <span class="op">=</span> <span class="va">structural_metadata_complete</span>, primary_key <span class="op">=</span> <span class="st">"key"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># oh also, the measured_by field is a foreign key</span></span>
<span></span>
<span><span class="va">structural_metadata_fk</span> <span class="op">&lt;-</span> <span class="fu">ohcleandat</span><span class="fu">::</span><span class="fu"><a href="../reference/update_structural_metadata.html">update_structural_metadata</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">data_to_describe</span>,</span>
<span>                                                                 metadata <span class="op">=</span> <span class="va">structural_metadata_pk</span>, </span>
<span>                                                                 foreign_key <span class="op">=</span> <span class="st">"measured_by"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## yeah we deleted that field - sorry!</span></span>
<span></span>
<span><span class="va">data_to_describe_drop_field</span> <span class="op">&lt;-</span> <span class="va">data_to_describe</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">field_we_dont_need</span><span class="op">)</span></span>
<span></span>
<span><span class="va">structural_metadata_clean</span> <span class="op">&lt;-</span> <span class="fu">ohcleandat</span><span class="fu">::</span><span class="fu"><a href="../reference/update_structural_metadata.html">update_structural_metadata</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">data_to_describe_drop_field</span>,</span>
<span>  metadata <span class="op">=</span> <span class="va">structural_metadata_fk</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/write.table.html" class="external-link">write.csv</a></span><span class="op">(</span><span class="va">structural_metadata_clean</span>,</span>
<span>          file <span class="op">=</span> <span class="st">"metadata_examples/structural_metadata.csv"</span>,</span>
<span>          row.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="depositing-data-into-an-archive-with-deposits">Depositing data into an archive with {deposits}<a class="anchor" aria-label="anchor" href="#depositing-data-into-an-archive-with-deposits"></a>
</h2>
<p>Okay - so I want to deposit my data using the <a href="https://docs.ropensci.org/deposits/" class="external-link">{deposits}</a> package.
{deposits} uses the <a href="https://docs.ropensci.org/frictionless/articles/frictionless.html" class="external-link">frictionless
data standard</a> so I end up with this thing called
<code>datapackage.json</code> that stores all of my metadata.</p>
<p>The <code>datapackage.json</code> structural metadata is pretty
minimal - it only includes field name and type (numeric, character,
etc). So we want to add our metadata to that.</p>
<p>See the <a href="https://docs.ropensci.org/deposits/articles/install-setup.html" class="external-link">{deposits}
setup guide</a> for getting an api token and installing the package. It
might also be helpful to review the <code>metadata_template.json</code>
file when creating the descriptive metadata. Only certain DCMI terms can
be included in the descriptive metadata and their formatting can be a
little tricky.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span></span>
<span><span class="co"># set deposits token </span></span>
<span><span class="co"># this can also be done in the `.Renviron` file or</span></span>
<span><span class="co"># via a .env file using the {dotenv} package</span></span>
<span><span class="co"># dotenv::load_dot_env(file = "../.env")</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Sys.setenv.html" class="external-link">Sys.setenv</a></span> <span class="op">(</span><span class="st">"ZENODO_SANDBOX_TOKEN"</span> <span class="op">=</span> <span class="st">"&lt;my-token&gt;"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># make sure your data are saved to a file</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/write.table.html" class="external-link">write.csv</a></span><span class="op">(</span><span class="va">data_to_describe_drop_field</span>,file <span class="op">=</span> <span class="st">"data_examples/my_data.csv"</span>,row.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># make sure your updated metadata file is loaded</span></span>
<span></span>
<span><span class="va">structural_metadata</span> <span class="op">&lt;-</span> <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_csv</a></span><span class="op">(</span><span class="st">"metadata_examples/structural_metadata_complete.csv"</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># Create descriptive metadata</span></span>
<span></span>
<span><span class="co"># check valid dcmi terms by calling deposits::dcmi_terms()</span></span>
<span><span class="co"># check see term defintions by calling: deposits::deposits_metadata_template(filename = "metadata_template.json")</span></span>
<span></span>
<span><span class="va">descriptive_metadata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span> <span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Example Dataset"</span>,</span>
<span>    description <span class="op">=</span> <span class="st">"This is the abstract"</span>,</span>
<span>    creator <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span> <span class="op">(</span>name <span class="op">=</span> <span class="st">"A. Person"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span> <span class="op">(</span>name <span class="op">=</span> <span class="st">"B. Person"</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="co"># , accessRights = "open"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># create a new client </span></span>
<span><span class="va">cli</span> <span class="op">&lt;-</span> <span class="fu">deposits</span><span class="fu">::</span><span class="va">depositsClient</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>service <span class="op">=</span> <span class="st">"zenodo"</span>,</span>
<span>                                    metadata <span class="op">=</span> <span class="va">descriptive_metadata</span>,</span>
<span>                                    sandbox <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># create a new deposit item - this  creates a placeholder in zenodo</span></span>
<span><span class="co"># for your items</span></span>
<span><span class="va">cli</span><span class="op">$</span><span class="fu">deposit_new</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># add your data - you can add individual files or whole folders</span></span>
<span><span class="co"># this will make a datapackage.json item in data_examples</span></span>
<span><span class="va">cli</span><span class="op">$</span><span class="fu">deposit_add_resource</span><span class="op">(</span>path <span class="op">=</span> <span class="st">"data_examples/my_data.csv"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## open the </span></span>
<span></span>
<span><span class="co"># Take a peak at the `datapackage.json` file - you'll see the first section</span></span>
<span><span class="co"># describes the csv file, the second section describes the data in the csv,</span></span>
<span><span class="co"># the third section contains the descriptive metadata we created</span></span>
<span></span>
<span><span class="co"># Add your structural metadata to the frictionless metadata</span></span>
<span></span>
<span><span class="fu"><a href="../reference/expand_frictionless_metadata.html">expand_frictionless_metadata</a></span><span class="op">(</span>structural_metadata <span class="op">=</span> <span class="va">structural_metadata</span>,</span>
<span>                             resource_name <span class="op">=</span> <span class="st">"my_data"</span>, <span class="co"># name of the file with no extension</span></span>
<span>                             resource_path <span class="op">=</span> <span class="st">"data_examples/my_data.csv"</span>,</span>
<span>                             data_package_path <span class="op">=</span> <span class="st">"data_examples/datapackage.json"</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co">## OOPs actually I need to add more to the description</span></span>
<span></span>
<span><span class="va">descriptive_metadata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span> <span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Example Dataset"</span>,</span>
<span>    description <span class="op">=</span> <span class="st">"This is the abstract but it needs more detail"</span>,</span>
<span>    creator <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span> <span class="op">(</span>name <span class="op">=</span> <span class="st">"A. Person"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span> <span class="op">(</span>name <span class="op">=</span> <span class="st">"B. Person"</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span> <span class="op">(</span>name <span class="op">=</span> <span class="st">"C. Person"</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span> <span class="op">(</span>name <span class="op">=</span> <span class="st">"F. Person"</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="co"># , accessRights = "open"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/update_frictionless_metadata.html">update_frictionless_metadata</a></span><span class="op">(</span>descriptive_metadata <span class="op">=</span> <span class="va">descriptive_metadata</span>,</span>
<span>                             data_package_path <span class="op">=</span> <span class="st">"data_examples/datapackage.json"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">cli</span><span class="op">$</span><span class="fu">deposit_fill_metadata</span><span class="op">(</span><span class="va">descriptive_metadata</span><span class="op">)</span></span>
<span><span class="co"># update deposit hangs if the descriptive metadata is not properly formatted, even after correction</span></span>
<span><span class="co"># upload to zenodo - this creates a **draft** deposit in Zenodo </span></span>
<span><span class="va">cli</span><span class="op">$</span><span class="fu">deposit_upload_file</span><span class="op">(</span>path <span class="op">=</span> <span class="st">"data_examples/"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># there are methods for embargoing or restricting deposits in {deposits}</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Collin Schwantes, Johana Teigen, Ernest Guevarra, Dean Marchiori, Melinda Rostal, EcoHealth Alliance.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
